import{slicedToArray as e,toConsumableArray as t,asyncToGenerator as a,regeneratorRuntime as r,createForOfIteratorHelper as n,objectSpread2 as o}from"./_virtual/_rollupPluginBabelHelpers.js";import{createClient as c}from"@supabase/supabase-js";import s from"dexie";import i from"papaparse";import{useState as u,useEffect as l}from"react";var d=c("https://dgesdafhrxbnapzdgoiy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRnZXNkYWZocnhibmFwemRnb2l5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0MjQ0NzUsImV4cCI6MjA2MzAwMDQ3NX0.S0s4DVfcjHgtOwx80NObSaa1zOLo9jrhbffAWCsLFvE"),m=new s("MediaTrackerDB");m.version(2).stores({users:"id, email",platforms:"name",media:"id, userId, type",seasons:"id, mediaId",episodes:"id, seasonId"});var p=function(){return"id_"+Math.random().toString(36).substr(2,9)},v=function(){localStorage.setItem("lastActivity",Date.now())},f=function(){var e=localStorage.getItem("lastActivity");return!e||Date.now()-parseInt(e)>9e5};function g(){var t=u(null),a=e(t,2),r=a[0],n=a[1],o=u([]),c=e(o,2),s=c[0],i=c[1],d=u(!1),p=e(d,2),v=p[0],g=p[1],h=u(""),R=e(h,2),k=R[0],w=R[1];l((function(){var e=localStorage.getItem("userId");if(f())return localStorage.removeItem("userId"),localStorage.removeItem("lastActivity"),void n(null);e&&m.users.get(e).then((function(t){t&&(n(t),m.media.where({userId:e}).toArray().then((function(e){return i(e)})))}))}),[]);return React.createElement("div",{className:"container"},React.createElement("h1",null,"Media Tracker (Versión 9.0)"),k&&React.createElement("p",{className:"error"},k),r?React.createElement(React.Fragment,null,React.createElement("p",null,"Bienvenido, ",r.email," ",React.createElement("button",{onClick:function(){localStorage.removeItem("userId"),localStorage.removeItem("lastActivity"),n(null),i([])}},"Cerrar Sesión")),React.createElement("button",{onClick:function(){return g(!0)}},"Agregar Película/Serie"),React.createElement(b,{user:r,setMedia:i}),v&&React.createElement(x,{user:r,setMedia:i,setShowAddForm:g}),React.createElement(y,{media:s,setMedia:i,user:r})):React.createElement(E,{setUser:n,setMedia:i,setError:w}))}function E(t){var a=t.setUser,r=t.setMedia,n=t.setError,o=u(!0),c=e(o,2),s=c[0],i=c[1];return s?React.createElement(h,{setUser:a,setMedia:r,setError:n,setShowLogin:i}):React.createElement(R,{setShowLogin:i,setError:n})}function h(t){var n=t.setUser,o=t.setMedia,c=t.setError,s=t.setShowLogin,i=u(""),l=e(i,2),p=l[0],f=l[1],g=u(""),E=e(g,2),h=E[0],R=E[1],b=u(!1),x=e(b,2),y=x[0],k=x[1],w=u(""),I=e(w,2),C=I[0],N=I[1],S=u(""),A=e(S,2),T=A[0],M=A[1],D=u(""),P=e(D,2),O=P[0],U=P[1],z=function(){var e=a(r().mark((function e(t){var a,s,i,u,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,d.auth.signInWithPassword({email:p,password:h});case 4:if(a=e.sent,s=a.data,!(i=a.error)){e.next=9;break}throw i;case 9:return e.next=11,m.users.where({email:p}).first();case 11:if(u=e.sent){e.next=19;break}return e.next=15,m.users.add({id:s.user.id,email:p});case 15:localStorage.setItem("userId",s.user.id),n({id:s.user.id,email:p}),e.next=25;break;case 19:return localStorage.setItem("userId",u.id),n(u),e.next=23,m.media.where({userId:u.id}).toArray();case 23:l=e.sent,o(l);case 25:v(),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(1),c("Error al iniciar sesión: "+e.t0.message);case 31:case"end":return e.stop()}}),e,null,[[1,28]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=a(r().mark((function e(){var t,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(""),U(""),e.prev=2,e.next=5,d.auth.resetPasswordForEmail(C,{redirectTo:"https://streaming-movies.netlify.app/reset-password"});case 5:if(t=e.sent,!(a=t.error)){e.next=9;break}throw a;case 9:U("Se ha enviado un enlace de restablecimiento a tu correo."),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),M("Error: "+e.t0.message);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}();return React.createElement("div",{className:"card"},React.createElement("h2",null,"Iniciar Sesión"),React.createElement("form",{onSubmit:z},React.createElement("input",{type:"email",placeholder:"Correo",value:p,onChange:function(e){return f(e.target.value)},required:!0}),React.createElement("input",{type:"password",placeholder:"Contraseña",value:h,onChange:function(e){return R(e.target.value)},required:!0}),React.createElement("input",{type:"submit",value:"Iniciar Sesión"})),React.createElement("p",null,"¿No tienes cuenta? ",React.createElement("button",{onClick:function(){return s(!1)}},"Regístrate")),React.createElement("p",null,React.createElement("button",{onClick:function(){return k(!0)}},"Olvidé mi contraseña")),React.createElement("div",{className:"modal",style:{display:y?"block":"none"}},React.createElement("div",{className:"modal-content"},React.createElement("h3",null,"Recuperar Contraseña"),React.createElement("input",{type:"email",placeholder:"Ingresa tu correo",value:C,onChange:function(e){return N(e.target.value)},required:!0}),T&&React.createElement("p",{className:"error"},T),O&&React.createElement("p",{style:{color:"green"}},O),React.createElement("div",{className:"flex",style:{marginTop:"10px"}},React.createElement("button",{onClick:L},"Enviar enlace"),React.createElement("button",{onClick:function(){return k(!1)}},"Cerrar")))))}function R(t){var n=t.setShowLogin,o=t.setError,c=u(""),s=e(c,2),i=s[0],l=s[1],p=u(""),v=e(p,2),f=v[0],g=v[1],E=function(){var e=a(r().mark((function e(t){var a,c,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,d.auth.signUp({email:i,password:f});case 4:if(a=e.sent,c=a.data,!(s=a.error)){e.next=9;break}throw s;case 9:return u=c.user.id,e.next=12,m.users.add({id:u,email:i});case 12:n(!0),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),o("Error al registrarse: "+e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}();return React.createElement("div",{className:"card"},React.createElement("h2",null,"Registrarse"),React.createElement("form",{onSubmit:E},React.createElement("input",{type:"email",placeholder:"Correo",value:i,onChange:function(e){return l(e.target.value)},required:!0}),React.createElement("input",{type:"password",placeholder:"Contraseña",value:f,onChange:function(e){return g(e.target.value)},required:!0}),React.createElement("input",{type:"submit",value:"Registrarse"})),React.createElement("p",null,"¿Ya tienes cuenta? ",React.createElement("button",{onClick:function(){return n(!0)}},"Inicia Sesión")))}function b(t){var n=t.user,o=t.setMedia,c=u(!1),s=e(c,2),l=s[0],d=s[1],p=function(){var e=a(r().mark((function e(){var t,a,n,o,c,s,u,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,a=["users","platforms","media","seasons","episodes"];case 2:if(!(t<a.length)){e.next=18;break}return n=a[t],e.next=6,m[n].toArray();case 6:o=e.sent,c=i.unparse(o),s=new Blob([c],{type:"text/csv"}),u=URL.createObjectURL(s),(l=document.createElement("a")).href=u,l.download="".concat(n,".csv"),l.click(),URL.revokeObjectURL(u);case 15:t++,e.next=2;break;case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=a(r().mark((function e(t,c){var s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.target.files[0],i.parse(s,{header:!0,complete:function(){var e=a(r().mark((function e(t){var a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,e.next=3,m[c].clear();case 3:return e.next=5,m[c].bulkAdd(a);case 5:if("media"!==c){e.next=10;break}return e.next=8,m.media.where({userId:n.id}).toArray();case 8:s=e.sent,o(s);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return React.createElement("div",null,React.createElement("button",{onClick:function(){return d(!0)}},"Configuración"),React.createElement("div",{className:"modal",style:{display:l?"block":"none"}},React.createElement("div",{className:"modal-content"},React.createElement("h3",null,"Configuración"),React.createElement("button",{onClick:p},"Exportar a CSV"),React.createElement("div",{style:{marginTop:"10px"}},React.createElement("h4",null,"Importar Datos"),["users","platforms","media","seasons","episodes"].map((function(e){return React.createElement("div",{key:e},React.createElement("label",null,e.charAt(0).toUpperCase()+e.slice(1),":"),React.createElement("input",{type:"file",accept:".csv",onChange:function(t){return v(t,e)}}))}))),React.createElement("button",{onClick:function(){return d(!1)},style:{marginTop:"10px"}},"Cerrar"))))}function x(o){var c=o.user,s=o.setMedia,i=o.setShowAddForm,d=u(""),g=e(d,2),E=g[0],h=g[1],R=u("película"),b=e(R,2),x=b[0],y=b[1],k=u(""),w=e(k,2),I=w[0],C=w[1],N=u(""),S=e(N,2),A=S[0],T=S[1],M=u(""),D=e(M,2),P=D[0],O=D[1],U=u(""),z=e(U,2),L=z[0],F=z[1],j=u("por ver"),V=e(j,2),q=V[0],G=V[1],B=u(""),J=e(B,2),X=J[0],Z=J[1],W=u([]),Y=e(W,2),H=Y[0],Q=Y[1],_=u([]),K=e(_,2),$=K[0],ee=K[1],te=u(null),ae=e(te,2),re=ae[0],ne=ae[1],oe=u(!1),ce=e(oe,2),se=ce[0],ie=ce[1],ue=u(""),le=e(ue,2),de=le[0],me=le[1];l((function(){m.platforms.toArray().then((function(e){ee(e.map((function(e){return e.name})).sort())}))}),[]),l((function(){if(console.log("Iniciando carga de temporadas - isEditing:",se,"type:",x),se&&"serie"===x){var e=function(){var e=a(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.seasons.where({mediaId:re.id}).toArray();case 3:return t=e.sent,e.next=6,Promise.all(t.map(function(){var e=a(r().mark((function e(t){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.episodes.where({seasonId:t.id}).toArray();case 2:return a=e.sent,e.abrupt("return",{id:t.id,seasonNumber:t.seasonNumber,episodeCount:t.episodeCount,episodes:a.map((function(e){return{id:e.id,episodeNumber:e.episodeNumber,duration:e.duration,watched:e.watched}}))});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:n=e.sent,Q(n),console.log("Temporadas cargadas para edición:",n),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),me("Error al cargar temporadas para edición: "+e.t0.message),console.error("Error al cargar temporadas:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();e()}else Q([]),console.log("No se cargan temporadas - isEditing:",se,"type:",x)}),[re,x]);var pe=function(){var e=a(r().mark((function e(a){var o,u,l,d,g,R,b,k,w,N,S,M,D,U,z,j,V,B,J,W,Y,_,K,te,ae,oe;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),console.log(se?"Editando medio:":"Agregando medio:",E),console.log("Plataforma ingresada:",I),!f()){e.next=9;break}return console.log("Sesión expirada al intentar guardar medio"),localStorage.removeItem("userId"),localStorage.removeItem("lastActivity"),me("Tu sesión ha expirado. Por favor, inicia sesión nuevamente."),e.abrupt("return");case 9:if("visto"!==q||X){e.next=13;break}return me('El rating es obligatorio cuando el estado es "visto".'),console.log('Error: Rating requerido para estado "visto"'),e.abrupt("return");case 13:if(I){e.next=17;break}return me("El campo Plataforma es obligatorio."),console.log("Error: Plataforma requerida"),e.abrupt("return");case 17:return e.prev=17,o=I.trim(),e.next=21,m.platforms.where({name:o}).first();case 21:if(e.sent){e.next=27;break}return e.next=25,m.platforms.add({name:o});case 25:console.log("Nueva plataforma añadida:",o),ee([].concat(t($),[o]).sort());case 27:if(u="Otro"===A?P:A,l=se?re.id:p(),!se){e.next=97;break}return console.log("Actualizando medio en IndexedDB:",{id:l,platform:I}),e.next=33,m.media.update(l,{title:E,type:x,platform:o,genre:u,duration:parseInt(L)||0,status:q,rating:X?parseInt(X):null});case 33:if("serie"!==x){e.next=95;break}return e.next=36,m.seasons.where({mediaId:l}).toArray();case 36:d=e.sent,g=n(d),e.prev=38,g.s();case 40:if((R=g.n()).done){e.next=48;break}return b=R.value,e.next=44,m.episodes.where({seasonId:b.id}).delete();case 44:return e.next=46,m.seasons.delete(b.id);case 46:e.next=40;break;case 48:e.next=53;break;case 50:e.prev=50,e.t0=e.catch(38),g.e(e.t0);case 53:return e.prev=53,g.f(),e.finish(53);case 56:k=n(H),e.prev=57,k.s();case 59:if((w=k.n()).done){e.next=87;break}return N=w.value,S=N.id||p(),M=N.episodes.reduce((function(e,t){return e+(t.duration||0)}),0),console.log("Guardando temporada (edición):",{seasonId:S,mediaId:l,seasonNumber:N.seasonNumber,episodeCount:N.episodeCount,totalDuration:M}),e.next=66,m.seasons.add({id:S,mediaId:l,seasonNumber:N.seasonNumber,episodeCount:N.episodeCount,totalDuration:M});case 66:D=n(N.episodes),e.prev=67,D.s();case 69:if((U=D.n()).done){e.next=77;break}return z=U.value,j=z.id||p(),console.log("Guardando episodio (edición):",{episodeId:j,seasonId:S,episodeNumber:z.episodeNumber,duration:z.duration,watched:z.watched}),e.next=75,m.episodes.add({id:j,seasonId:S,episodeNumber:z.episodeNumber,duration:z.duration||0,watched:z.watched});case 75:e.next=69;break;case 77:e.next=82;break;case 79:e.prev=79,e.t1=e.catch(67),D.e(e.t1);case 82:return e.prev=82,D.f(),e.finish(82);case 85:e.next=59;break;case 87:e.next=92;break;case 89:e.prev=89,e.t2=e.catch(57),k.e(e.t2);case 92:return e.prev=92,k.f(),e.finish(92);case 95:e.next=140;break;case 97:return console.log("Guardando nuevo medio en IndexedDB:",{id:l,platform:I}),e.next=100,m.media.add({id:l,userId:c.id,title:E,type:x,platform:o,genre:u,duration:parseInt(L)||0,status:q,rating:X?parseInt(X):null});case 100:if("serie"!==x){e.next=140;break}V=n(H),e.prev=102,V.s();case 104:if((B=V.n()).done){e.next=132;break}return J=B.value,W=p(),Y=J.episodes.reduce((function(e,t){return e+(t.duration||0)}),0),console.log("Guardando temporada:",{seasonId:W,mediaId:l,seasonNumber:J.seasonNumber,episodeCount:J.episodeCount,totalDuration:Y}),e.next=111,m.seasons.add({id:W,mediaId:l,seasonNumber:J.seasonNumber,episodeCount:J.episodeCount,totalDuration:Y});case 111:_=n(J.episodes),e.prev=112,_.s();case 114:if((K=_.n()).done){e.next=122;break}return te=K.value,ae=p(),console.log("Guardando episodio:",{episodeId:ae,seasonId:W,episodeNumber:te.episodeNumber,duration:te.duration,watched:te.watched}),e.next=120,m.episodes.add({id:ae,seasonId:W,episodeNumber:te.episodeNumber,duration:te.duration||0,watched:te.watched});case 120:e.next=114;break;case 122:e.next=127;break;case 124:e.prev=124,e.t3=e.catch(112),_.e(e.t3);case 127:return e.prev=127,_.f(),e.finish(127);case 130:e.next=104;break;case 132:e.next=137;break;case 134:e.prev=134,e.t4=e.catch(102),V.e(e.t4);case 137:return e.prev=137,V.f(),e.finish(137);case 140:return e.next=142,m.media.where({userId:c.id}).toArray();case 142:oe=e.sent,console.log("Medios recargados después de guardar:",oe),s(oe),h(""),y("película"),C(""),T(""),F(""),G("por ver"),Z(""),Q([]),O(""),ne(null),ie(!1),i(!1),me(""),console.log(se?"Medio actualizado:":"Medio añadido:",{id:l,title:E,platform:I}),v(),e.next=166;break;case 162:e.prev=162,e.t5=e.catch(17),me(se?"Error al editar medio: "+e.t5.message:"Error al agregar medio: "+e.t5.message),console.error("Error:",e.t5);case 166:case"end":return e.stop()}}),e,null,[[17,162],[38,50,53,56],[57,89,92,95],[67,79,82,85],[102,134,137,140],[112,124,127,130]])})));return function(t){return e.apply(this,arguments)}}();return React.createElement("div",{className:"modal"},React.createElement("div",{className:"modal-content"},React.createElement("h3",null,se?"Editar":"Agregar"," Película/Serie"),de&&React.createElement("p",{className:"error"},de),React.createElement("form",{onSubmit:pe},React.createElement("input",{type:"text",placeholder:"Título",value:E,onChange:function(e){return h(e.target.value)},required:!0}),React.createElement("select",{value:x,onChange:function(e){return y(e.target.value)}},React.createElement("option",{value:"película"},"Película"),React.createElement("option",{value:"serie"},"Serie")),React.createElement("input",{type:"text",placeholder:"Plataforma",value:I,onChange:function(e){return C(e.target.value)},list:"platforms",required:!0}),React.createElement("datalist",{id:"platforms"},$.map((function(e){return React.createElement("option",{key:e,value:e})}))),React.createElement("select",{value:A,onChange:function(e){return T(e.target.value)}},React.createElement("option",{value:""},"Selecciona un género"),React.createElement("option",{value:"Acción"},"Acción"),React.createElement("option",{value:"Drama"},"Drama"),React.createElement("option",{value:"Comedia"},"Comedia"),React.createElement("option",{value:"Terror"},"Terror"),React.createElement("option",{value:"Ciencia ficción"},"Ciencia ficción"),React.createElement("option",{value:"Otro"},"Otro")),"Otro"===A&&React.createElement("input",{type:"text",placeholder:"Especifica el género",value:P,onChange:function(e){return O(e.target.value)}}),React.createElement("input",{type:"number",placeholder:"Duración (min)",value:L,onChange:function(e){return F(e.target.value)},disabled:"serie"===x}),React.createElement("select",{value:q,onChange:function(e){return G(e.target.value)}},React.createElement("option",{value:"por ver"},"Por ver"),React.createElement("option",{value:"viendo"},"Viendo"),React.createElement("option",{value:"visto"},"Visto")),"visto"===q&&React.createElement("select",{value:X,onChange:function(e){return Z(e.target.value)}},React.createElement("option",{value:""},"Selecciona un rating"),t(Array(10)).map((function(e,t){return React.createElement("option",{key:t+1,value:t+1},t+1)}))),"serie"===x&&React.createElement("div",null,React.createElement("h4",null,"Temporadas"),React.createElement("button",{type:"button",onClick:function(){var e={seasonNumber:H.length+1,episodeCount:1,episodes:[{episodeNumber:1,duration:0,watched:!1}]};Q([].concat(t(H),[e])),console.log("Temporada añadida en MediaForm:",e),console.log("Estado seasons actualizado:",[].concat(t(H),[e]))}},"Agregar Temporada"),H.map((function(e,a){return React.createElement("div",{key:e.seasonNumber,style:{marginTop:"10px"}},React.createElement("p",null,"Temporada ",e.seasonNumber),React.createElement("label",null,"Cantidad de episodios:"),React.createElement("input",{type:"number",min:"1",value:e.episodeCount,onChange:function(e){return function(e,a){var r=t(H);r[e].episodeCount=parseInt(a),r[e].episodes=Array.from({length:a},(function(t,a){var n,o;return{episodeNumber:a+1,duration:(null===(n=r[e].episodes[a])||void 0===n?void 0:n.duration)||0,watched:(null===(o=r[e].episodes[a])||void 0===o?void 0:o.watched)||!1}})),Q(r)}(a,e.target.value)}}),e.episodes.map((function(e,r){return React.createElement("div",{key:e.episodeNumber,className:"flex",style:{marginTop:"5px"}},React.createElement("span",null,"Episodio ",e.episodeNumber),React.createElement("input",{type:"number",placeholder:"Duración (min)",value:e.duration,onChange:function(e){return function(e,a,r){var n=t(H);n[e].episodes[a].duration=parseInt(r)||0,Q(n)}(a,r,e.target.value)}}),React.createElement("label",null,"Visto:",React.createElement("input",{type:"checkbox",checked:e.watched,onChange:function(e){return function(e,a,r){var n=t(H);n[e].episodes[a].watched=r,Q(n)}(a,r,e.target.checked)}})))})))}))),React.createElement("div",{className:"flex",style:{marginTop:"10px"}},React.createElement("input",{type:"submit",value:se?"Actualizar":"Agregar"}),React.createElement("button",{type:"button",onClick:function(){i(!1),ne(null),ie(!1)}},"Cancelar")))))}function y(o){var c=o.media,s=o.setMedia,i=o.user,d=u(""),p=e(d,2),g=p[0],E=p[1],h=u(""),R=e(h,2),b=R[0],y=R[1],w=u(""),I=e(w,2),C=I[0],N=I[1],S=u(""),A=e(S,2),T=A[0],M=A[1],D=u([]),P=e(D,2),O=P[0],U=P[1],z=u([]),L=e(z,2),F=L[0],j=L[1];l((function(){m.platforms.toArray().then((function(e){U(e.map((function(e){return e.name})).sort())}));var e=t(new Set(c.map((function(e){return e.genre})))).filter((function(e){return e})).sort();j(e)}),[c]);var V=c.filter((function(e){return!(g&&e.type!==g||b&&e.platform!==b||C&&e.genre!==C||T&&e.status!==T)})),q=function(){var e=a(r().mark((function e(t){var a,o,c,u,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f()){e.next=5;break}return localStorage.removeItem("userId"),localStorage.removeItem("lastActivity"),alert("Tu sesión ha expirado. Por favor, inicia sesión nuevamente."),e.abrupt("return");case 5:return e.next=7,m.media.delete(t);case 7:return e.next=9,m.seasons.where({mediaId:t}).toArray();case 9:a=e.sent,o=n(a),e.prev=11,o.s();case 13:if((c=o.n()).done){e.next=21;break}return u=c.value,e.next=17,m.episodes.where({seasonId:u.id}).delete();case 17:return e.next=19,m.seasons.delete(u.id);case 19:e.next=13;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(11),o.e(e.t0);case 26:return e.prev=26,o.f(),e.finish(26);case 29:return e.next=31,m.media.where({userId:i.id}).toArray();case 31:l=e.sent,s(l),v();case 34:case"end":return e.stop()}}),e,null,[[11,23,26,29]])})));return function(t){return e.apply(this,arguments)}}();return React.createElement("div",null,React.createElement("h2",null,"Lista de Medios"),React.createElement("div",{className:"flex"},React.createElement("select",{value:g,onChange:function(e){return E(e.target.value)}},React.createElement("option",{value:""},"Todos los tipos"),React.createElement("option",{value:"película"},"Película"),React.createElement("option",{value:"serie"},"Serie")),React.createElement("select",{value:b,onChange:function(e){return y(e.target.value)}},React.createElement("option",{value:""},"Todas las plataformas"),O.map((function(e){return React.createElement("option",{key:e,value:e},e)}))),React.createElement("select",{value:C,onChange:function(e){return N(e.target.value)}},React.createElement("option",{value:""},"Todos los géneros"),F.map((function(e){return React.createElement("option",{key:e,value:e},e)}))),React.createElement("select",{value:T,onChange:function(e){return M(e.target.value)}},React.createElement("option",{value:""},"Todos los estados"),React.createElement("option",{value:"por ver"},"Por ver"),React.createElement("option",{value:"viendo"},"Viendo"),React.createElement("option",{value:"visto"},"Visto"))),V.map((function(e){return React.createElement("div",{key:e.id,className:"card"},React.createElement("h3",null,e.title," (",e.type.charAt(0).toUpperCase()+e.type.slice(1),")"),React.createElement("p",null,"Plataforma: ",e.platform),React.createElement("p",null,"Género: ",e.genre||"No especificado"),"película"===e.type&&React.createElement("p",null,"Duración: ",e.duration," min"),React.createElement("p",null,"Estado: ",e.status.charAt(0).toUpperCase()+e.status.slice(1)),"visto"===e.status&&React.createElement("p",null,"Rating: ",e.rating,"/10"),"serie"===e.type&&React.createElement(k,{mediaId:e.id}),React.createElement("div",{className:"flex"},React.createElement("button",{onClick:function(){return t=e,a=document.createElement("div"),void ReactDOM.render(React.createElement(x,{user:i,setMedia:s,setShowAddForm:function(){return ReactDOM.unmountComponentAtNode(a)},editingMedia:t,isEditing:!0}),a);var t,a}},"Editar"),React.createElement("button",{onClick:function(){return q(e.id)},style:{background:"#dc3545"}},"Eliminar")))})))}function k(t){var n=t.mediaId,c=u([]),s=e(c,2),i=s[0],d=s[1],p=function(){var e=a(r().mark((function e(){var t,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Cargando temporadas para medio:",n),e.prev=1,e.next=4,m.seasons.where({mediaId:n}).toArray();case 4:return t=e.sent,console.log("Temporadas encontradas:",t),e.next=8,Promise.all(t.map(function(){var e=a(r().mark((function e(t){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.episodes.where({seasonId:t.id}).toArray();case 2:return a=e.sent,console.log("Episodios para temporada ".concat(t.id,":"),a),e.abrupt("return",o(o({},t),{},{episodes:a,completed:a.every((function(e){return e.watched}))}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:c=e.sent,d(c),console.log("Temporadas cargadas con episodios:",c),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("Error al cargar temporadas:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(){return e.apply(this,arguments)}}();l((function(){p()}),[n]),l((function(){0===i.length&&(console.log("seasons está vacío, intentando recargar datos..."),p())}),[i]);var g=function(){var e=a(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f()){e.next=5;break}return localStorage.removeItem("userId"),localStorage.removeItem("lastActivity"),alert("Tu sesión ha expirado. Por favor, inicia sesión nuevamente."),e.abrupt("return");case 5:return e.next=7,m.episodes.update(t,{watched:a});case 7:p(),v();case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return console.log("Renderizando SeriesDetails - seasons:",i),React.createElement("div",{style:{marginTop:"20px"}},React.createElement("h4",{style:{fontWeight:"bold"}},"Temporadas"),i.length>0?i.map((function(e){return React.createElement("div",{key:e.id,style:{marginTop:"10px"}},React.createElement("p",null,"Temporada ",e.seasonNumber," ",e.completed?"(Completada)":""),e.episodes.map((function(e){return React.createElement("div",{key:e.id,className:"flex",style:{marginTop:"5px"}},React.createElement("input",{type:"checkbox",checked:e.watched,onChange:function(){return g(e.id,!e.watched)}}),React.createElement("span",null,"Episodio ",e.episodeNumber," (",e.duration," min)"))})))})):React.createElement("p",{style:{color:"#666"}},"No hay temporadas registradas."))}export{g as default};
